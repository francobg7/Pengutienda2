<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Penguin</title>
</head>
<body>
    <h1>Bienvenido a la Tienda Penguin</h1>

    <h2>Productos disponibles</h2>
    <div id="products"></div>

    <h2>Realizar un pedido</h2>
    <form id="orderForm">
        <label for="name">Nombre:</label>
        <input type="text" id="name" required><br>

        <label for="address">Dirección:</label>
        <input type="text" id="address" required><br>

        <div id="productSelections"></div>

        <button type="submit">Enviar Pedido</button>
    </form>

    <div id="orderMessage"></div>

    <script>
    window.onload = () => {
        fetch("http://localhost:8080/products")
        .then(response => response.json())
        .then(products => {
            const productsDiv = document.getElementById("products");
            const productSelections = document.getElementById("productSelections");

            if (products.length === 0) {
                productsDiv.innerHTML = "<p>No hay productos disponibles.</p>";
                return;
            }

            productsDiv.innerHTML = products.map(product => 
                `<p><strong>${product.name}</strong>: $${product.price} - ${product.description} (Stock: ${product.stock})</p>`
            ).join("");

            productSelections.innerHTML = products.map(product => `
                <div>
                    <label>
                        <input type="checkbox" name="productId" value="${product._id}">
                        ${product.name}
                    </label>
                    <input type="number" min="1" max="${product.stock}" value="1" 
                    name="quantity_${product._id}" style="width: 60px">
                </div>
            `).join("");
        })
        .catch(err => console.error("Error al obtener los productos:", err));
    };

    document.getElementById("orderForm").onsubmit = (event) => {
        event.preventDefault();

        const selectedProducts = document.querySelectorAll('input[name="productId"]:checked');
        const products = Array.from(selectedProducts).map(input => ({
            productId: input.value,
            quantity: parseInt(document.querySelector(`input[name="quantity_${input.value}"]`).value)
        }));

        fetch("http://localhost:8080/orders", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                name: document.getElementById("name").value,
                address: document.getElementById("address").value,
                products
            }),
        })
        .then(response => {
            document.getElementById("orderMessage").innerText = 
                response.ok ? "Pedido realizado con éxito." : "Error al realizar el pedido.";
        })
        .catch(err => console.error("Error al realizar el pedido:", err));
    };
    </script>
</body>
</html>